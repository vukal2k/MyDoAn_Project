@model DTO.GanttChartViewModel

@using COMMON;
@using Microsoft.AspNet.Identity
@{
    ViewBag.Title = "GanttChart";
    Layout = "~/Views/Shared/_LayoutProject.cshtml";
}

<link href="~/Content/gantt.css" rel="stylesheet" />
<h2>Gantt Chart</h2>

<div style="height:500px; overflow-y:scroll;">
    <div class="gantt">
        <div class="gantt__row gantt__row--months">
            <div class="gantt__row-first"></div>
            @*<span>Jan</span><span>Feb</span><span>Mar</span>
                <span>Apr</span><span>May</span><span>Jun</span>
                <span>Jul</span><span>Aug</span><span>Sep</span>
                <span>Oct</span><span>Nov</span><span>Dec</span>*@

            @foreach (var item in Model.ListDay)
            {
                <span>@item.ToLongDateString()</span>
            }
        </div>
        <div class="gantt__row gantt__row--lines" data-month="5">
            @*<span></span><span></span><span></span>
                <span></span><span></span><span></span>
                <span></span><span class="marker"></span><span></span>
                <span></span><span></span><span></span>*@
            <span></span>
            @foreach (var item in Model.ListDay)
            {
                if (item == DateTime.Today)
                {
                    <span class="marker"></span>
                }
                else
                {
                    <span></span>
                }
            }
        </div>
        @foreach (var item in Model.ListTask)
        {
            <div class="gantt__row">
                <div class="gantt__row-first">
                    <a href="@Url.Action("TaskList","Project", new { id = item.Task.Module.ProjectId,chooseTaskId=item.Task.Id})">@item.Task.Title</a>
                </div>
                <ul class="gantt__row-bars">
                    @if (item.Task.To < DateTime.Today.AddDays(1) && item.Task.StatusId<TaskStatusKey.Resolved)
                    {
                        <li style="grid-column: @string.Format("{0}/{1}",item.FromIndex,item.ToIndex); background-color: #ff6252;" class="stripes">@item.Task.AssignedTo</li>
                    }
                    else
                    {
                        <li style="grid-column: @string.Format("{0}/{1}",item.FromIndex,item.ToIndex); background-color: #00a65a;" class="stripes">@item.Task.AssignedTo</li>
                    }
                </ul>
            </div>
        }
    </div>
</div>

<div class="row">
    <div class="col-md-5">
        <a class="pull-left btn btn-default" href="@Url.Action("GanttChart","Project", new { id=Model.Project.Id, page=Model.Page-1})"><i class="fas fa-arrow-left"></i> Prev Week</a>
    </div>
    <div class="col-md-2">
        <a class="btn btn-primary" href="@Url.Action("GanttChart","Project", new { id=Model.Project.Id})">Current Week"</a>
    </div>
    <div class="col-md-5">
        <a class="pull-right  btn btn-default" href="@Url.Action("GanttChart","Project", new { id=Model.Project.Id, page=Model.Page+1})">Next Week <i class="fas fa-arrow-right"></i></a>

    </div>
</div>

@section Scripts{
    <script>
        $(document).ready(() => {
            var roleCurrentUser = @Model.Project.GetRoleInModule(User.Identity.GetUserName());
            if (@Model.Project.StatusId==@ProjectStatusKey.Opened || roleCurrentUser == @HardFixJobRole.PM) {
                $("#sidebar0").addClass('active');
                $("#sidebar0").children().attr("href", '@Url.Action("GanttChart", "Project", new { id = Model.Project.Id })')
                $("#sidebar1").children().attr("href", '@Url.Action("KanbanBoard", "Project", new { id = Model.Project.Id })') 

                $("#linkSidebar21").attr("href", '@Url.Action("TaskList", "Project", new { id = Model.Project.Id })')
                if (roleCurrentUser !== 0 && roleCurrentUser !== @HardFixJobRole.Watcher) {
                    $("#linkSidebar22").attr("href", '@Url.Action("TaskList", "Project", new { id = Model.Project.Id, createTask =true})')
                }
                else {
                    $("#linkSidebar22").remove();
                }

                $("#linkSidebar2-51").attr("href", '@Url.Action("RequestList", "Project", new { id = Model.Project.Id })')
                if (roleCurrentUser !== @HardFixJobRole.PM) {
                    $("#linkSidebar2-52").attr("href", '@Url.Action("RequestList", "Project", new { id = Model.Project.Id, createTask =true})')
                }
                else {
                    $("#linkSidebar2-52").remove();
                }


                if (roleCurrentUser === @HardFixJobRole.PM) {
                    $("#linkSidebar31").attr("href",'@Url.Action("KanbanBoard", "Project", new { id = Model.Project.Id })')
                    $("#linkSidebar31").attr("href", '@Url.Action("Index", "Module", new { id = Model.Project.Id })')

                    $("#linkSidebar32").attr("href",'@Url.Action("KanbanBoard", "Project", new { id = Model.Project.Id })')
                    $("#linkSidebar32").attr("href", '@Url.Action("Create", "Module", new { id = Model.Project.Id })')

                    $("#sidebar41").attr("href", '@Url.Action("Infomation", "Project", new { id = Model.Project.Id })')
                    $("#sidebar42").attr("href", '@Url.Action("Statistic", "Project", new { id = Model.Project.Id })')
                }
                else {
                    $("#sidebar3").remove();
                    $("#sidebar4").remove();
                }
            }
            else {
                $("#sidebar0").remove();
                $("#sidebar1").remove();
                $("#sidebar2-5").remove();
                $("#sidebar2").remove();
                $("#sidebar3").remove();
                $("#sidebar4").remove();
            }
        });
    </script>
}